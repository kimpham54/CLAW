<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Alpaca Technical Stack - Islandora CLAW</title>
      
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Islandora CLAW">
    <meta property="og:image" content="None/../../assets/claw.png">
    <meta name="apple-mobile-web-app-title" content="Islandora CLAW">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../assets/claw.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Roboto', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-red palette-accent-red">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Technical Documentation <i class="icon icon-link"></i>
              
            
          </span>
        
        Alpaca Technical Stack
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/islandora" title="@islandora on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/kimpham54/CLAW" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../assets/claw.png">
        </div>
      
      <div class="name">
        <strong>
          Islandora CLAW
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          kimpham54/CLAW
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/kimpham54/CLAW/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/kimpham54/CLAW/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <span class="section">User Documentation</span>
    <ul>
      
        
  <li>
    <a class="" title="Introduction to Islandora CLAW" href="../../user-documentation/intro-to-claw/">
      Introduction to Islandora CLAW
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Islandora CLAW for 1.x Users" href="../../user-documentation/CLAWfor1x/">
      Islandora CLAW for 1.x Users
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Technical Documentation</span>
    <ul>
      
        
  <li>
    <a class="" title="Minimum Viable Product" href="../../mvp/mvp_doc/">
      Minimum Viable Product
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="How to build documenation" href="../../technical-documentation/docs-build/">
      How to build documenation
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Syncing Drupal Project" href="../../technical-documentation/drupal-project/">
      Syncing Drupal Project
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Versioning Policy" href="../../technical-documentation/versioning/">
      Versioning Policy
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Alpaca Technical Stack" href="./">
      Alpaca Technical Stack
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="OSGi" href="#osgi">
                OSGi
              </a>
            </li>
          
            <li class="anchor">
              <a title="Karaf" href="#karaf">
                Karaf
              </a>
            </li>
          
            <li class="anchor">
              <a title="Gradle" href="#gradle">
                Gradle
              </a>
            </li>
          
            <li class="anchor">
              <a title="Apache Camel" href="#apache-camel">
                Apache Camel
              </a>
            </li>
          
            <li class="anchor">
              <a title="Apache ActiveMQ" href="#apache-activemq">
                Apache ActiveMQ
              </a>
            </li>
          
            <li class="anchor">
              <a title="References" href="#references">
                References
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Components</span>
    <ul>
      
        
  <li>
    <a class="" title="Islandora CLAW" href="../..">
      Islandora CLAW
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Alpaca" href="../README/">
      Alpaca
    </a>
    
  </li>

      
        
  <li>
    <span class="section">Drupal modules</span>
    <ul>
      
        
  <li>
    <a class="" title="Islandora" href="../../islandora/README/">
      Islandora
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Islandora Collection" href="../../islandora_collection/README/">
      Islandora Collection
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Islandora Image" href="../../islandora_image/README/">
      Islandora Image
    </a>
    
  </li>

      
    </ul>
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Installation</span>
    <ul>
      
        
  <li>
    <a class="" title="Installation (Vagrant)" href="../../install/README/">
      Installation (Vagrant)
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Contributing</span>
    <ul>
      
        
  <li>
    <a class="" title="How to contribute" href="../../contributing/CONTRIBUTING/">
      How to contribute
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Committers" href="../../contributing/committers/">
      Committers
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Hacking on Islandora" href="../../contributing/hacking-on-islandora/">
      Hacking on Islandora
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Migration</span>
    <ul>
      
        
  <li>
    <a class="" title="Migration" href="../../migration/migration/">
      Migration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Fedora namespace predicates" href="../../migration/fedora-namespace-predicates/">
      Fedora namespace predicates
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Islandora namespace predicates" href="../../migration/islandora-namespace-predicates/">
      Islandora namespace predicates
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/islandora" target="_blank" title="@islandora on Twitter">
                  @islandora on Twitter
                </a>
              </li>
            
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="alpaca-technical-stack">Alpaca Technical Stack</h1>
<p>Alpaca contains several OSGI modules or bundles. They are grouped together as features and deployed to Karaf container.</p>
<h2 id="osgi"><a href="https://www.osgi.org/developer/architecture/">OSGi</a></h2>
<p>OSGi is a specification to develop and deploy modular Java applications. It allows for dynamic deployment (hot deployment) and dependency management. </p>
<p>The base unit of resources is called a bundle. Bundle is similar to a jar file, with additional information to be processed as an OSGi component. Several bundles can be grouped together into a Feature and installed together. OSGi bundles can be run on containers implementing the OSGi specification. Apache Karaf is one such container</p>
<h2 id="karaf"><a href="https://karaf.apache.org/manual/latest/overview.html">Karaf</a></h2>
<p>Apache Karaf is a container that can be used to deploy an array of applications such servlets, Apache Camel components, jars etc. </p>
<h3 id="karaf-bundle-hello-world">Karaf - Bundle - Hello World</h3>
<p>Download a bundle to the <a href="https://github.com/Islandora-CLAW/claw_vagrant">CLAW vagrant</a> (ex to <code>/home/ubuntu</code> directory). An example hello world bundle is <a href="https://github.com/moghaddam/developmentor/blob/master/helloworld/target/helloworld-1.0.0.jar">here</a>. </p>
<p>In Islandora CLAW vagrant, you can login to Karaf using ssh. The password is karaf. You can also use the client here: <code>/opt/karaf/bin/client</code>. Karaf client allows the use of linux commands such as <code>grep</code> in addition to Karaf commands.  </p>
<pre><code>ssh -p 8101 karaf@localhost
</code></pre>

<p>Install the bundle:</p>
<pre><code>karaf@root()&gt; bundle
karaf@root(bundle)&gt; install file:///home/ubuntu/helloworld-1.0.0.jar
Bundle ID: 242
</code></pre>

<p>The installation will return a bundle id. You can issue the list command to verify that bundle is on the list. Initially it will have <em>Installed</em> status.</p>
<p>As per OSGi specification, before a bundle can be started, it has to be Resolved. To resolve, issue the following command.  </p>
<pre><code>karaf@root(bundle)&gt; resolve 242
</code></pre>

<p>You can start and stop the bundle as below.</p>
<pre><code>karaf@root(bundle)&gt; start 242
Hello World!
karaf@root(bundle)&gt; stop 242
Goodbye World!
karaf@root(bundle)&gt; 
</code></pre>

<h3 id="karaf-features-hello-world">Karaf - Features - Hello World</h3>
<p>Karaf Features allows for bundles to be grouped, managed and deployed together. Features can be nested as well. Feature files of frameworks such as Apache Camel or Apache ActiveMQ can be used to deploy those services.  </p>
<p>A simple Features file is as below.  </p>
<pre><code>&lt;features&gt;
  &lt;feature name='greeter_server' version='1.0'&gt;
    &lt;bundle&gt;file:///home/ubuntu/helloworld-1.0.0.jar&lt;/bundle&gt;
    &lt;bundle&gt;file:///home/ubuntu/helloworld2-1.0.0.jar&lt;/bundle&gt;
  &lt;/feature&gt;
&lt;/features&gt;
</code></pre>

<p>You can add the features to Karaf as below:</p>
<pre><code>karaf@root()&gt; feature:repo-add file:///home/ubuntu/features.xml
</code></pre>

<p>You can install the feature's bundles as below.  </p>
<pre><code>karaf@root(feature)&gt; install greeter_server
Hello World 2 !
Hello World!
</code></pre>

<p>Uninstalling the feature.</p>
<pre><code>karaf@root(feature)&gt; uninstall greeter_server
Goodbye World 2 !
Goodbye World!

</code></pre>

<h2 id="gradle"><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">Gradle</a></h2>
<p>Gradle is used by Alpaca as a build and package management tool. It is similar to <a href="https://maven.apache.org/">Maven</a>.  </p>
<h2 id="apache-camel"><a href="http://camel.apache.org/book-getting-started.html">Apache Camel</a></h2>
<p>Apache Camel is an integration framework that aids in implementing integration patterns.  </p>
<h3 id="alpaca-apache-camel-helloworld">Alpaca - Apache Camel HelloWorld</h3>
<p>Maven has camel-archetype-blueprint which can be used to create apache-camel OSGi bundle project structure.  </p>
<h4 id="creating-a-projectbundle-under-alpaca">Creating a project/bundle under Alpaca</h4>
<pre><code>mvn archetype:generate -DarchetypeGroupId=org.apache.camel.archetypes -DarchetypeArtifactId=camel-archetype-blueprint -DarchetypeVersion=2.9.0 -DarchetypeRepository=https://repository.apache.org/content/groups/snapshots-g
</code></pre>

<p>However, it is easier to copy the structure of an existing project such as <a href="https://github.com/Islandora-CLAW/Alpaca/tree/master/islandora-connector-broadcast">islandora-connector-broadcast</a>.</p>
<pre><code>cp -R islandora-connector-broadcast/ islandora-connector-helloworld

</code></pre>

<p>Open the project in your IDE. In Eclipse, you can go to File | Open Projects from File System and navigate the new folder.  </p>
<p>We need to rename the configuration, java and build files to reflect the helloworld project.  </p>
<ul>
<li><code>src/main/cfg/ca.islandora.alpaca.connector.helloworld.cfg</code></li>
<li><code>src/main/java/ca/islandora/alpaca/connector/helloworld</code></li>
<li><code>src/main/java/ca/islandora/alpaca/connector/helloworld/HelloworldRouter.java</code></li>
</ul>
<p>Also change the content of the above file to log Hello World</p>
<pre><code>package ca.islandora.alpaca.connector.helloworld;

import static org.apache.camel.LoggingLevel.INFO;

import org.apache.camel.builder.RouteBuilder;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HelloworldRouter extends RouteBuilder {

    private static final Logger LOGGER = LoggerFactory.getLogger(HelloworldRouter.class);

    /**
     * Configure the message route workflow.
     */
    public void configure() throws Exception {

        // Hello World.
        from(&quot;timer:foo?period=5000&quot;).log(INFO, LOGGER, &quot;Hello World&quot;);
    }
}

</code></pre>

<ul>
<li><code>src/main/resource/OSGI-INF/blueprint/blueprint.xml</code> - Change the content of this file to reflect Helloworld package.  </li>
<li><code>src/build.gradle</code></li>
</ul>
<pre><code>apply plugin: 'osgi'

description = 'Islandora CLAW HelloWorld'

dependencies {
    compile group: 'org.apache.camel', name: 'camel-core', version: camelVersion
    compile group: 'org.apache.camel', name: 'camel-blueprint', version: camelVersion
    compile group: 'org.apache.activemq', name: 'activemq-camel', version: activemqVersion
    compile group: 'org.slf4j', name: 'slf4j-api', version: slf4jVersion
    testCompile group: 'org.apache.camel', name: 'camel-test-blueprint', version: camelVersion
}

jar {
    manifest {
        description project.description
        docURL project.docURL
        vendor project.vendor
        license project.license

        instruction 'Import-Package', 'org.apache.activemq.camel.component,' +
                            &quot;org.apache.camel;version=\&quot;${camelVersionRange}\&quot;,&quot; +
                            defaultOsgiImports
        instruction 'Export-Package', 'ca.islandora.alpaca.connector.helloworld'
    }
}

artifacts {
    archives (file('build/cfg/main/ca.islandora.alpaca.connector.helloworld.cfg')) {
        classifier 'configuration'
        type 'cfg'
    }
}
</code></pre>

<h4 id="building-the-bundle">Building the bundle</h4>
<p>To build this project, we have to update the Alpaca build settings. Include and add the project in <code>Alpaca/settings.gradle</code>.</p>
<pre><code>include ':islandora-connector-helloworld'
project(':islandora-connector-helloworld').projectDir = &quot;$rootDir/islandora-connector-helloworld&quot; as File
</code></pre>

<p>Normally, we would also have to update the <code>karaf/src/main/resources/features.xml</code> file to include this bundle. However, we will be deploying the bundle directly into Karaf's Hot deployment directory. Thus, not needed at this time.</p>
<p>To build it from command line in Linux.</p>
<pre><code>ubuntu:~/workspace/Alpaca$ sudo gradle w build
</code></pre>

<h4 id="deploying-the-bundle">Deploying the bundle</h4>
<ul>
<li>Upload the bundle to the Apache Karaf deploy directory: <code>/opt/apache-karaf-4.0.5/deploy</code></li>
<li>Login to Karaf. You can also use the Karaf client here: <code>/opt/karaf/bin/client</code>.</li>
</ul>
<pre><code>ssh -p 8101 karaf@localhost
</code></pre>

<ul>
<li>Verify that bundle is deployed</li>
</ul>
<pre><code>bundle:list
</code></pre>

<ul>
<li>See the log to confirm that the bundle is working.</li>
</ul>
<pre><code>log:tail
</code></pre>

<p>You should see a message like below:</p>
<pre><code>2017-02-24 21:30:17,973 | INFO  | 12 - timer://foo | HelloworldRouter                 | 186 - ca.islandora.alpaca.islandora-connector-helloworld - 0.2.1.SNAPSHOT | Hello World
</code></pre>

<h2 id="apache-activemq"><a href="http://activemq.apache.org/getting-started.html">Apache ActiveMQ</a></h2>
<p>Apache ActiveMQ is a JMS compliant Messaging Queue. Messaging client can make use of JMS to send messages.</p>
<h3 id="installing-activemq">Installing ActiveMQ</h3>
<p>Installing ActiveMQ is relatively easy. Download the latest stable release <a href="http://activemq.apache.org/download.html">here</a>. Go to the <code>activemq_install_dir/bin</code>. Start the ActiveMQ by using the activemq script or batch file and start command.</p>
<pre><code>$ cd activemq_install_dir/bin
$ ./activemq start
</code></pre>

<p>When ActiveMQ gets started, go to http://localhost:8161/admin/. You can login using admin:admin.</p>
<p>Note that ActiveMQ in CLAW vagrant does not have a UI.  </p>
<h2 id="references">References</h2>
<ul>
<li><a href="http://www.theserverside.com/news/1363825/OSGi-for-Beginners">OSGI for Beginners</a></li>
<li><a href="http://www.javaindeed.com/playing-with-apache-karaf-console/">Playing with Apache Karaf Console</a></li>
<li><a href="https://karaf.apache.org/manual/latest/quick-start.html">Karaf Quick Start</a></li>
<li><a href="http://tech.lalitbhatt.net/2014/08/activemq-introduction.html">ActiveMQ Introduction</a></li>
</ul>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../../technical-documentation/versioning/" title="Versioning Policy">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Versioning Policy
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../.." title="Islandora CLAW">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Islandora CLAW
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'kimpham54/CLAW';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>